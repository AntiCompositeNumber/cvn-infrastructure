#!/bin/bash

# Sync cvn logs to NFS for archiving and publishing

host="$(hostname -s 2>/dev/null)"
if [ -z "$host" ]; then
	echo "Unable to determine hostname" >&2
	exit 1
fi

rsync -c --recursive --delete-after --force /srv/cvn/log/ "/data/project/cvn-common/log/$host/"
if [[ $? != 0 ]]; then
	echo "Publishing local logs to /data/project/cvn-common failed" >&2
	exit 1
fi
